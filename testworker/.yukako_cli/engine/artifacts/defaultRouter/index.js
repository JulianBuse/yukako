var p=console.log,c=t=>{console.log=(...s)=>{let r={id:t.id,type:t.type,name:t.name},n=JSON.stringify(r);p(`__START_YUKAKO_LOG_HEADER__${n}__END_YUKAKO_LOG_HEADER__`,...s)}};var _={fetch:async(t,s)=>{c({id:s.__meta.id,type:"router",name:"yukako-router"});let r=t.headers.get("x-forwarded-host")||t.headers.get("host")||"",n=new URL(t.url);if(console.log(`[router] ${t.method} ${n.pathname}${n.search} ${r}`),!r)return new Response("No x-forwarded-host header",{status:400});let i=Object.values(s.__meta.routes).filter(e=>e.host===r||e.host==="*");if(i.length===0)return new Response("No service matching host",{status:404});let a=i.filter(e=>{if(!e.paths||e.paths.length===0)return!0;let h=new URL(t.url);for(let u of e.paths)if(h.pathname.startsWith(u))return!0});if(a.length===0)return new Response("No service matching path",{status:404});let g=a[0],o=s[g.service];return!o||!o.fetch?new Response("No service found",{status:404}):o.fetch(t)}};export{_ as default};
